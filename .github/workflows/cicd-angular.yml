name: CI/CD Angular avec Cypress

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  ci:
    name: ğŸ” Lint, Test & Cypress
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“‚ Checkout du Code
        uses: actions/checkout@v4

      - name: ğŸ—ï¸ Installer Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: ğŸ“¦ Installer les DÃ©pendances
        run: npm ci

  cd:
    name: ğŸš€ Build & Deploy
    needs: ci
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“‚ Checkout du Code
        uses: actions/checkout@v4

      - name: ğŸ—ï¸ Installer Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: ğŸ“¦ Installer les DÃ©pendances
        run: npm ci

      - name: ğŸ—ï¸ Construire l'Application
        run: npm run build -- --configuration=production --base-href /

      - name: ğŸš€ DÃ©ploiement sur GitHub Pages
        if: success()
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages
          folder: dist/etoileberbere-site/browser
          clean: true

